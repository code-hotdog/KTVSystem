{"remainingRequest":"D:\\研课程\\ktv-select_music-system-master\\ktv-select_music-system-master\\ktv-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\研课程\\ktv-select_music-system-master\\ktv-select_music-system-master\\ktv-admin\\src\\views\\login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\研课程\\ktv-select_music-system-master\\ktv-select_music-system-master\\ktv-admin\\src\\views\\login.vue","mtime":1585972675000},{"path":"D:\\研课程\\ktv-select_music-system-master\\ktv-select_music-system-master\\ktv-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\研课程\\ktv-select_music-system-master\\ktv-select_music-system-master\\ktv-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\研课程\\ktv-select_music-system-master\\ktv-select_music-system-master\\ktv-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\研课程\\ktv-select_music-system-master\\ktv-select_music-system-master\\ktv-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport wsmLoading from \"@/plugins/wsmLoading\"\nimport jwt_decode from 'jwt-decode';\nexport default {\n    name:\"login\",\n    data(){\n        const validateCaptcha = (rule, value, callback) => {\n            if(!this.inputCaptcha.trim().length){\n                callback(new Error('请输入验证码~'));\n            }else{\n                callback();\n            }\n        }\n        return{\n            inline:true,\n            inlinemessage:false,\n            loginForm:{\n                email:\"\",\n                password:\"\"\n            },\n            loginRule:{\n                email:[\n                    {required:true,message:\"邮箱不能为空\",trigger:\"blur\"},\n                    {type:\"email\",message:\"请输入正确的邮箱\",trigger:\"blur\"},\n                ],\n                password:[\n                    {required:true,message:\"密码不能为空\",trigger:\"blur\"},\n                    {min:6,max:20,message:\"密码长度在6-20之间\",trigger:\"blur\"}\n                ],\n                inputCaptcha:[\n                    {required:true, validator:validateCaptcha,trigger:\"blur\"}\n                ]\n            },\n            inputCaptcha:\"\"\n        }\n    },\n    methods:{\n        // 登录\n        submitForm(formName){\n            this.$refs[formName].validate(valid => {\n                if(valid){\n                    wsmLoading.start(\"正在登录,请稍候...\")\n                    setTimeout(() => {\n                        if(this.inputCaptcha.toLowerCase() == this.getCookie(\"captcha\")){\n                            this.$axios.post(\"http://localhost:8633/api/admin/account/login\", this.loginForm)\n                                .then(res => {\n                                    if(res){\n                                        // 解析token\n                                        const {token} = res.data;\n                                        localStorage.setItem(\"adminToken\", token);\n                                        const decoded = jwt_decode(token);\n                                        // 存储vuex中\n                                        this.$store.dispatch(\"setAdminInfo\", decoded);\n                                        this.$store.dispatch(\"isAdminAuthorization\", true);\n                                        this.$Message.success(`${decoded.username}登录成功`)\n                                        wsmLoading.end();\n                                        this.$router.push(\"/\");\n                                    }\n                                })\n                                .catch(error => {\n                                    console.error(error.response);\n                                    this.refreshCaptcha();\n                                })\n                        }else{\n                            wsmLoading.end();\n                            this.$Modal.confirm({\n                                title:\"错误\",\n                                content:\"你输入的验证码有误,请重新输入验证码~\",\n                                type:\"error\",\n                                onOk:()=>{\n                                    // this.refreshCaptcha();\n                                }\n                            })\n                        }\n                    }, 900)\n                }\n            })\n        },\n        // 获取验证码cookie\n        getCookie(cname){\n            var name = cname + \"=\";\n            var ca = document.cookie.split(';');\n            for(var i=0; i<ca.length; i++){\n                var c = ca[i].trim();\n                if (c.indexOf(name)==0) return c.substring(name.length,c.length);\n            }\n            return \"\";\n        },\n        // 刷新验证码\n        refreshCaptcha(){\n            this.$refs.captcha.src = \"http://localhost:8633/api/safecode?d=\" + Math.random();\n        },\n    }\n}\n",{"version":3,"sources":["login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"login.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div class=\"login\">\n        <div class=\"login-title\">\n            后台管理系统\n        </div>\n        <div class=\"form-box\">\n            <el-form class=\"login-form\" label-position=\"top\" size=\"small\" :inline-message=\"inlinemessage\" :model=\"loginForm\" :rules=\"loginRule\" ref=\"loginForm\" label-width=\"100px\">\n                <el-form-item label=\"Email address\" prop=\"email\">\n                    <el-input type=\"text\" v-model=\"loginForm.email\" placeholder=\"请输入邮箱\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"Password\" prop=\"password\">\n                    <el-input type=\"password\" @keypress.enter.native=\"submitForm('loginForm')\" show-password v-model=\"loginForm.password\" placeholder=\"请输入密码\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"Security Code\" prop=\"inputCaptcha\">\n                    <div class=\"yzm\">\n                        <el-input style=\"width:150px;\" v-model=\"inputCaptcha\" placeholder=\"验证码\"></el-input>\n                        <img width=\"80\" style=\"background:#EEE9E9;margin-left:30px;\" ref=\"captcha\" height=\"32\" src=\"http://localhost:8633/api/safecode\" @click=\"refreshCaptcha\">\n                    </div>\n                </el-form-item>\n                <el-form-item>\n                    <el-button class=\"login-btn\" type=\"primary\" @click=\"submitForm('loginForm')\">Sign in</el-button>\n                </el-form-item>\n            </el-form>\n        </div>\n    </div>\n</template>\n<script>\nimport wsmLoading from \"@/plugins/wsmLoading\"\nimport jwt_decode from 'jwt-decode';\nexport default {\n    name:\"login\",\n    data(){\n        const validateCaptcha = (rule, value, callback) => {\n            if(!this.inputCaptcha.trim().length){\n                callback(new Error('请输入验证码~'));\n            }else{\n                callback();\n            }\n        }\n        return{\n            inline:true,\n            inlinemessage:false,\n            loginForm:{\n                email:\"\",\n                password:\"\"\n            },\n            loginRule:{\n                email:[\n                    {required:true,message:\"邮箱不能为空\",trigger:\"blur\"},\n                    {type:\"email\",message:\"请输入正确的邮箱\",trigger:\"blur\"},\n                ],\n                password:[\n                    {required:true,message:\"密码不能为空\",trigger:\"blur\"},\n                    {min:6,max:20,message:\"密码长度在6-20之间\",trigger:\"blur\"}\n                ],\n                inputCaptcha:[\n                    {required:true, validator:validateCaptcha,trigger:\"blur\"}\n                ]\n            },\n            inputCaptcha:\"\"\n        }\n    },\n    methods:{\n        // 登录\n        submitForm(formName){\n            this.$refs[formName].validate(valid => {\n                if(valid){\n                    wsmLoading.start(\"正在登录,请稍候...\")\n                    setTimeout(() => {\n                        if(this.inputCaptcha.toLowerCase() == this.getCookie(\"captcha\")){\n                            this.$axios.post(\"http://localhost:8633/api/admin/account/login\", this.loginForm)\n                                .then(res => {\n                                    if(res){\n                                        // 解析token\n                                        const {token} = res.data;\n                                        localStorage.setItem(\"adminToken\", token);\n                                        const decoded = jwt_decode(token);\n                                        // 存储vuex中\n                                        this.$store.dispatch(\"setAdminInfo\", decoded);\n                                        this.$store.dispatch(\"isAdminAuthorization\", true);\n                                        this.$Message.success(`${decoded.username}登录成功`)\n                                        wsmLoading.end();\n                                        this.$router.push(\"/\");\n                                    }\n                                })\n                                .catch(error => {\n                                    console.error(error.response);\n                                    this.refreshCaptcha();\n                                })\n                        }else{\n                            wsmLoading.end();\n                            this.$Modal.confirm({\n                                title:\"错误\",\n                                content:\"你输入的验证码有误,请重新输入验证码~\",\n                                type:\"error\",\n                                onOk:()=>{\n                                    // this.refreshCaptcha();\n                                }\n                            })\n                        }\n                    }, 900)\n                }\n            })\n        },\n        // 获取验证码cookie\n        getCookie(cname){\n            var name = cname + \"=\";\n            var ca = document.cookie.split(';');\n            for(var i=0; i<ca.length; i++){\n                var c = ca[i].trim();\n                if (c.indexOf(name)==0) return c.substring(name.length,c.length);\n            }\n            return \"\";\n        },\n        // 刷新验证码\n        refreshCaptcha(){\n            this.$refs.captcha.src = \"http://localhost:8633/api/safecode?d=\" + Math.random();\n        },\n    }\n}\n</script>\n<style lang=\"less\" scoped>\n.login{\n    width: 100%;\n    height: 100%;\n    cursor: default;\n    padding: 40px 0px;\n    color:red;\n    background-image: url(../assets/image/login-bg.jpg);\n    background-size: 100% 100%;\n    display: flex;\n    flex-direction: column;\n\n    .login-title{\n        width:100%;\n        height: 150px;\n        line-height: 150px;\n        text-align: center;\n        font-size: 40px;\n        color: aliceblue;\n        font-family: \"隶书\";\n    }\n\n    // 表单\n    .form-box{\n        width: 100%;\n        // min-width: 500px;\n\n        .login-form{\n            width: 300px;\n            margin: 0px auto;\n            background-color: rgba(255, 255, 255,.9);\n            border: 1px solid #cdcdcd;\n            padding: 10px 15px;\n            border-radius: 5px;\n\n            .login-btn{\n                width: 100%;\n                background: linear-gradient(to bottom, rgba(47, 228, 89, 0.9),#26a744);\n                font-weight: 600;\n            }\n            .login-btn:hover{\n                background-color: rgb(94, 255, 132);\n            }\n\n\n            // 验证码区域\n            .yzm{\n                display:flex;\n                align-content:center;\n                input{\n                    width: 160px;\n                    height: 32px;\n                    outline: none;\n                    border: 1px solid #eee;\n                    padding: 2px 15px;\n                    border-radius: 5px;\n                    font-size: 13px;\n                }\n                ::-webkit-input-placeholder{\n                    color:#bbb;\n                }\n                img:hover{\n                    cursor: pointer;\n                }\n            }\n\n        }\n    } \n}\n</style>\n"]}]}